#pragma once
#include <Windows.h>

#include <iostream>
#include <memory>

#include "event_ids.h"

class CServiceBase;

class Logger {
   public:
    static std::shared_ptr<Logger> GetInstance(CServiceBase* service_instance = nullptr);

    Logger(CServiceBase* service_instance) : service_instance_(service_instance) {}
    void LogMessage(const std::wstring& msg, DWORD type = EVENTLOG_INFORMATION_TYPE) const;
    const Logger& operator<<(const std::wstring& msg) const;

    inline auto service_instance() const& noexcept -> const CServiceBase* {
        return service_instance_;
    }
    inline auto service_instance() & noexcept -> CServiceBase*& { return service_instance_; }

   protected:
    CServiceBase* service_instance_;
    static std::shared_ptr<Logger> logger_instance_;
};